import{a as he}from"./chunk-ZCJL6GD4.js";import{a as se,b as me,d as de,e as fe}from"./chunk-LY44IPX2.js";import{a as le,b as ce,i as ue,l as pe}from"./chunk-YZ7SGSAS.js";import{A as v,Aa as X,Ba as Y,Da as Z,E as s,F as c,G as h,Ga as G,Ia as K,J as B,K as U,L as y,Ma as ee,Na as te,O as p,P as _,Pa as ie,Q as x,S as N,Ta as oe,X as V,Ya as ne,_a as re,ab as ae,c as A,l as C,m as S,q as H,r as j,s as L,u as W,v as a,w as f,wa as q,x as E,y as b,ya as Q,z as T,za as J}from"./chunk-IJ2NUXZ7.js";import"./chunk-5KK65VHC.js";import"./chunk-7KGURMOZ.js";import"./chunk-KLFTJJ6R.js";import"./chunk-HYKU3UWQ.js";import"./chunk-IWMO5IXQ.js";import"./chunk-RKNHQKOL.js";import"./chunk-EJTOQN7U.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-QXLGPNHK.js";import"./chunk-AHWCWOS7.js";import"./chunk-42C7ZIID.js";import{g}from"./chunk-7QKZJC6O.js";function ve(u,d){if(u&1&&(s(0,"ion-card")(1,"ion-card-header")(2,"ion-item",7)(3,"ion-avatar",8),h(4,"img",9),c(),s(5,"ion-label")(6,"h2"),p(7),c(),s(8,"p"),p(9),c()()()(),s(10,"ion-list",10)(11,"ion-item"),h(12,"ion-icon",11),s(13,"ion-label",12),p(14,"\u0E40\u0E02\u0E49\u0E32\u0E07\u0E32\u0E19: "),c(),s(15,"ion-label",13),p(16),c()(),s(17,"ion-item"),h(18,"ion-icon",14),s(19,"ion-label",12),p(20,"\u0E2D\u0E2D\u0E01\u0E07\u0E32\u0E19: "),c(),s(21,"ion-label",13),p(22),c()()(),s(23,"ion-card-content"),h(24,"ion-progress-bar",15),s(25,"p",16),p(26),c()()()),u&2){let o=y();a(4),b("src",o.userProfile.image_profile,W),a(3),N("\u0E04\u0E38\u0E13 ",o.userProfile.firstname," ",o.userProfile.lastname," [",o.userProfile.nickname,"]"),a(2),x("\u0E2A\u0E32\u0E02\u0E32: ",o.userProfile.branch,""),a(7),_(o.getHourMinute(o.userProfile.only_time)),a(6),_(o.getHourMinute(o.userProfile.check_out)),a(2),b("value",o.getWorkPercentage("09:00","18:00",o.getHourMinute(o.userProfile.only_time),o.getHourMinute(o.userProfile.check_out))),a(2),x("\u0E40\u0E27\u0E25\u0E32\u0E17\u0E33\u0E07\u0E32\u0E19 ",o.calcTime,"")}}function _e(u,d){if(u&1&&(s(0,"ion-text",17),p(1),h(2,"br"),p(3),c()),u&2){let o=y(2);a(),x(" \u0E27\u0E31\u0E19\u0E19\u0E35\u0E49\u0E44\u0E14\u0E49\u0E25\u0E07\u0E40\u0E27\u0E25\u0E32\u0E2D\u0E2D\u0E01\u0E07\u0E32\u0E19\u0E41\u0E25\u0E49\u0E27 ",o.datetimeTH(o.userProfile.check_out)," \u0E19. "),a(2),x("\u0E40\u0E27\u0E25\u0E32\u0E17\u0E33\u0E07\u0E32\u0E19 ",o.calcTime,"")}}function Ce(u,d){u&1&&(s(0,"ion-text",17),p(1,"\u0E01\u0E23\u0E38\u0E13\u0E32\u0E25\u0E07\u0E40\u0E27\u0E25\u0E32\u0E40\u0E02\u0E49\u0E32\u0E07\u0E32\u0E19\u0E01\u0E48\u0E2D\u0E19"),c())}function Se(u,d){if(u&1){let o=B();s(0,"ion-footer",6),E(1,_e,4,2,"ion-text",17)(2,Ce,2,0,"ion-text",17),s(3,"ion-button",18),U("click",function(){j(o);let e=y();return L(e.confirmCheckOut())}),p(4,"\u0E25\u0E07\u0E40\u0E27\u0E25\u0E32\u0E2D\u0E2D\u0E01\u0E07\u0E32\u0E19"),c()()}if(u&2){let o=y();a(),v(o.showStampTime&&o.userProfile.check_out?1:o.showStampTime?-1:2),a(2),b("disabled",!o.userProfile||!o.showStampTime||o.userProfile.check_out)}}var xe=(()=>{let d=class d{constructor(t,e,i,n,r,l){this._lineLiffService=t,this._userActive=e,this._toastCtrl=i,this._alertCtrl=n,this._authService=r,this._recordService=l,this.currentDay="",this.currentTime="",this.calcTime="",this.showStampTime=!1,this._unsubscribeAll=new A,le({informationCircle:pe,closeOutline:ue,alarm:ce}),this.currentDay=this.formatThaiDate(new Date)}ngOnInit(){}ngAfterViewInit(){var t;if(se.production&&!((t=this.userProfile)!=null&&t.id))this._lineLiffService.InitLine("2007900555-BpbQkZkj").then(e=>{setTimeout(()=>{var r,l,m;console.log("::-State-::",e,"----",this.userProfile),this.lineProfile=e,(r=this.userProfile)!=null&&r.firstname||this.sendFlexRegister();let i=new Date("".concat((l=this.userProfile)==null?void 0:l.only_date," ").concat((m=this.userProfile)==null?void 0:m.only_time)).getDate(),n=new Date().getDate();console.log(i,n),i===n&&(this.showStampTime=!0)},1500)});else{let e={accountId:"U5667e78a6c1cf68bc0d1b3d049217330",photoUrl:"https://profile.line-scdn.net/0h2BiEaIiIbW1EPHmHrNQTEjRsbgdnTTR_bwh1DiM8MlwpDH1raVghXiI0N1h-BSo4PF4kDnI0M19ILxoLWmqRWUMMM1p9CSs6bFwqjA",accountName:"Jarurat"};this.user(e)}this.updateTime(),this.intervalId=setInterval(()=>{this.updateTime()},1e3)}sendFlexRegister(){this._lineLiffService.sendFlexMessage([{type:"flex",altText:"\u0E01\u0E23\u0E38\u0E13\u0E32\u0E25\u0E07\u0E17\u0E30\u0E40\u0E1A\u0E35\u0E22\u0E19\u0E40\u0E1E\u0E37\u0E48\u0E2D\u0E40\u0E02\u0E49\u0E32\u0E43\u0E0A\u0E49\u0E07\u0E32\u0E19\u0E23\u0E30\u0E1A\u0E1A",contents:{type:"bubble",hero:{type:"image",url:"https://farmai.us/time-logs/assets/logo.png",aspectRatio:"2:1",size:"full",aspectMode:"fit",position:"relative"},body:{type:"box",layout:"vertical",contents:[{type:"box",layout:"vertical",contents:[{type:"text",text:"\u0E23\u0E30\u0E1A\u0E1A\u0E1A\u0E31\u0E19\u0E17\u0E36\u0E01\u0E40\u0E27\u0E25\u0E32\u0E07\u0E32\u0E19",size:"lg",color:"#ffffff",weight:"bold"},{type:"text",text:"\u0E01\u0E23\u0E38\u0E13\u0E32\u0E25\u0E07\u0E17\u0E30\u0E40\u0E1A\u0E35\u0E22\u0E19\u0E40\u0E1E\u0E37\u0E48\u0E2D\u0E40\u0E02\u0E49\u0E32\u0E43\u0E0A\u0E49\u0E07\u0E32\u0E19\u0E23\u0E30\u0E1A\u0E1A",size:"sm",color:"#FFFFFF"}]},{type:"box",layout:"vertical",contents:[{type:"filler"},{type:"box",layout:"baseline",contents:[{type:"filler"},{type:"text",text:"\u0E25\u0E07\u0E17\u0E30\u0E40\u0E1A\u0E35\u0E22\u0E19",color:"#ffffff",flex:0,offsetTop:"-2px"},{type:"filler"}],spacing:"sm"},{type:"filler"}],borderWidth:"1px",cornerRadius:"4px",spacing:"sm",borderColor:"#ffffff",margin:"xxl",height:"40px",action:{type:"uri",label:"action",uri:"https://liff.line.me/2007900555-9ypO313N"}}],backgroundColor:"#bf1c2dCC"}}}])}user(t){return g(this,null,function*(){var e,i;try{let n=yield C(this._authService.user(t).pipe(S(this._unsubscribeAll)));if(n!=null&&n.data){let r=n==null?void 0:n.data;this._userActive.setActiveUser(r),this.presentToast("\u0E2A\u0E27\u0E31\u0E2A\u0E14\u0E35 ".concat((e=r==null?void 0:r.firstname)!=null?e:""," ").concat(r==null?void 0:r.lastname),"success");let l=new Date("".concat((i=this.userProfile)==null?void 0:i.only_date)).getDate(),m=new Date().getDate();console.log(l,m),l===m&&(this.showStampTime=!0)}}catch(n){console.error("\u274C [ERROR] \u0E2A\u0E48\u0E07\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E2A\u0E33\u0E40\u0E23\u0E47\u0E08:",n)}})}getCurrentTime(t,e=!0){let i=m=>m.toString().padStart(2,"0"),n=i(t.getHours()),r=i(t.getMinutes()),l=i(t.getSeconds());return e?"".concat(n," : ").concat(r," : ").concat(l):"".concat(n,":").concat(r)}updateTime(){var t,e;if(this.currentTime=this.getCurrentTime(new Date),this.showStampTime){let i=new Date("".concat((t=this.userProfile)==null?void 0:t.only_date," ").concat((e=this.userProfile)==null?void 0:e.only_time));this.userProfile.check_out?this.calcTime=this.calculateWorkDuration(i,new Date(this.userProfile.check_out)):this.showStampTime&&(this.calcTime=this.calculateWorkDuration(i,new Date))}}getMinutes(t){let[e,i]=t.split(":").map(Number);return e*60+i}sendFlexMessage(){var m,w,P,D,I,k,M,$,F,z;let t=ge=>{let O=new Date(ge),R=be=>be.toString().padStart(2,"0"),ye=R(O.getHours()),Ee=R(O.getMinutes());return"".concat(ye,":").concat(Ee)},e=new Date("".concat((m=this.userProfile)==null?void 0:m.only_date," ").concat((w=this.userProfile)==null?void 0:w.only_time)),i=new Date,n=this.calculateWorkDuration(e,i),r=t(e.toISOString()),l=t(i.toISOString());this._lineLiffService.sendFlexMessage([{type:"flex",altText:"\u0E1A\u0E31\u0E19\u0E17\u0E36\u0E01\u0E25\u0E07\u0E40\u0E27\u0E25\u0E32\u0E2D\u0E2D\u0E01\u0E07\u0E32\u0E19",contents:{type:"bubble",size:"mega",header:{type:"box",layout:"vertical",contents:[{type:"text",text:"\u0E25\u0E07\u0E40\u0E27\u0E25\u0E32\u0E2D\u0E2D\u0E01\u0E07\u0E32\u0E19",size:"xl",weight:"bold",color:"#ffffff"}],paddingAll:"20px",backgroundColor:"#FF6B6E",spacing:"md",height:"72px",paddingTop:"22px"},body:{type:"box",layout:"vertical",contents:[{type:"box",layout:"horizontal",contents:[{type:"box",layout:"vertical",contents:[{type:"image",url:(D=(P=this.userProfile)==null?void 0:P.image_profile)!=null?D:"https://developers-resource.landpress.line.me/fx/clip/clip13.jpg",size:"full",aspectMode:"cover"}],width:"56px",height:"56px",cornerRadius:"100px"},{type:"box",layout:"vertical",contents:[{type:"text",text:"\u0E04\u0E38\u0E13".concat((k=(I=this.userProfile)==null?void 0:I.firstname)!=null?k:""," ").concat((M=this.userProfile)==null?void 0:M.lastname," ").concat((F=($=this.userProfile)==null?void 0:$.nickname)!=null?F:""),size:"sm",weight:"bold",offsetTop:"8px"},{type:"text",text:"\u0E2A\u0E32\u0E02\u0E32: ".concat((z=this.userProfile)==null?void 0:z.branch_at),size:"xs",offsetTop:"8px"}],offsetStart:"16px"}]},{type:"text",text:this.currentDay,size:"sm",offsetTop:"8px"},{type:"box",layout:"horizontal",contents:[{type:"text",text:r,size:"sm",gravity:"center"},{type:"box",layout:"vertical",contents:[{type:"filler"},{type:"box",layout:"vertical",contents:[],cornerRadius:"30px",height:"12px",width:"12px",borderColor:"#1DB446",borderWidth:"2px"},{type:"filler"}],flex:0},{type:"text",text:"\u0E40\u0E02\u0E49\u0E32\u0E07\u0E32\u0E19",gravity:"center",flex:4,size:"sm"}],spacing:"lg",cornerRadius:"30px",margin:"xl"},{type:"box",layout:"horizontal",contents:[{type:"box",layout:"baseline",contents:[{type:"filler"}],flex:1},{type:"box",layout:"vertical",contents:[{type:"box",layout:"horizontal",contents:[{type:"filler"},{type:"box",layout:"vertical",contents:[],width:"2px",backgroundColor:"#B7B7B7"},{type:"filler"}],flex:1}],width:"12px"},{type:"text",text:n,gravity:"center",flex:4,size:"xs",color:"#8c8c8c"}],spacing:"lg",height:"64px"},{type:"box",layout:"horizontal",contents:[{type:"box",layout:"horizontal",contents:[{type:"text",text:l,gravity:"center",size:"sm"}],flex:1},{type:"box",layout:"vertical",contents:[{type:"filler"},{type:"box",layout:"vertical",contents:[],cornerRadius:"30px",width:"12px",height:"12px",borderWidth:"2px",borderColor:"#EF454D"},{type:"filler"}],flex:0},{type:"text",text:"\u0E2D\u0E2D\u0E01\u0E07\u0E32\u0E19",gravity:"center",flex:4,size:"sm"}],spacing:"lg",cornerRadius:"30px"}]}}}])}formatThaiDate(t){let e=["\u0E2D\u0E32\u0E17\u0E34\u0E15\u0E22\u0E4C","\u0E08\u0E31\u0E19\u0E17\u0E23\u0E4C","\u0E2D\u0E31\u0E07\u0E04\u0E32\u0E23","\u0E1E\u0E38\u0E18","\u0E1E\u0E24\u0E2B\u0E31\u0E2A\u0E1A\u0E14\u0E35","\u0E28\u0E38\u0E01\u0E23\u0E4C","\u0E40\u0E2A\u0E32\u0E23\u0E4C"],i=["\u0E21\u0E01\u0E23\u0E32\u0E04\u0E21","\u0E01\u0E38\u0E21\u0E20\u0E32\u0E1E\u0E31\u0E19\u0E18\u0E4C","\u0E21\u0E35\u0E19\u0E32\u0E04\u0E21","\u0E40\u0E21\u0E29\u0E32\u0E22\u0E19","\u0E1E\u0E24\u0E29\u0E20\u0E32\u0E04\u0E21","\u0E21\u0E34\u0E16\u0E38\u0E19\u0E32\u0E22\u0E19","\u0E01\u0E23\u0E01\u0E0E\u0E32\u0E04\u0E21","\u0E2A\u0E34\u0E07\u0E2B\u0E32\u0E04\u0E21","\u0E01\u0E31\u0E19\u0E22\u0E32\u0E22\u0E19","\u0E15\u0E38\u0E25\u0E32\u0E04\u0E21","\u0E1E\u0E24\u0E28\u0E08\u0E34\u0E01\u0E32\u0E22\u0E19","\u0E18\u0E31\u0E19\u0E27\u0E32\u0E04\u0E21"],n=e[t.getDay()],r=t.getDate(),l=i[t.getMonth()],m=t.getFullYear()+543;return"\u0E27\u0E31\u0E19".concat(n," \u0E17\u0E35\u0E48 ").concat(r," ").concat(l," ").concat(m)}presentToast(t,e="primary"){return g(this,null,function*(){(yield this._toastCtrl.create({message:t,duration:2e3,color:e,position:"bottom"})).present()})}checkOut(){return g(this,null,function*(){var t;try{let e={id:(t=this.userProfile)==null?void 0:t.logs_id},i=yield C(this._recordService.setTimeRecord(e).pipe(S(this._unsubscribeAll)));console.log(i),i!=null&&i.data?this.sendFlexMessage():this.presentToast("\u0E21\u0E35\u0E1A\u0E32\u0E07\u0E2D\u0E22\u0E48\u0E32\u0E07\u0E1C\u0E34\u0E14\u0E1E\u0E25\u0E32\u0E14 \u0E42\u0E1B\u0E23\u0E14\u0E25\u0E2D\u0E07\u0E2D\u0E35\u0E01\u0E04\u0E23\u0E31\u0E49\u0E07!!","danger")}catch(e){console.error("\u274C [ERROR] \u0E2A\u0E48\u0E07\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E44\u0E21\u0E48\u0E2A\u0E33\u0E40\u0E23\u0E47\u0E08:",e)}})}confirmCheckOut(){return g(this,null,function*(){(yield this._alertCtrl.create({header:"\u0E22\u0E37\u0E19\u0E22\u0E31\u0E19\u0E01\u0E32\u0E23\u0E2D\u0E2D\u0E01\u0E40\u0E27\u0E25\u0E32\u0E17\u0E33\u0E07\u0E32\u0E19",subHeader:"\u0E1A\u0E31\u0E19\u0E17\u0E36\u0E01\u0E2D\u0E2D\u0E01\u0E40\u0E27\u0E25\u0E32\u0E17\u0E33\u0E07\u0E32\u0E19\u0E43\u0E0A\u0E48\u0E2B\u0E23\u0E37\u0E2D\u0E44\u0E21\u0E48",buttons:[{text:"\u0E22\u0E01\u0E40\u0E25\u0E34\u0E01",role:"cancel"},{text:"\u0E22\u0E37\u0E19\u0E22\u0E31\u0E19",role:"confirm",handler:()=>this.checkOut()}]})).present()})}get userProfile(){return this._userActive.activeUser}datetimeTH(t){let e={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(t).toLocaleDateString("th",e)}calculateWorkDuration(t,e){let i=e.getTime()-t.getTime();if(i<0)throw new Error("\u0E40\u0E27\u0E25\u0E32\u0E2A\u0E34\u0E49\u0E19\u0E2A\u0E38\u0E14\u0E15\u0E49\u0E2D\u0E07\u0E21\u0E32\u0E01\u0E01\u0E27\u0E48\u0E32\u0E40\u0E27\u0E25\u0E32\u0E40\u0E23\u0E34\u0E48\u0E21\u0E15\u0E49\u0E19");let n=Math.floor(i/(1e3*60)),r=Math.floor(n/60),l=n%60;return"".concat(r," \u0E0A\u0E31\u0E48\u0E27\u0E42\u0E21\u0E07 ").concat(l," \u0E19\u0E32\u0E17\u0E35")}getWorkPercentage(t,e,i,n){let r=this.getMinutes(e)-this.getMinutes(t);return((this.getMinutes(n)-this.getMinutes(i))/r).toFixed(2)}getHourMinute(t){if(!t)return"";let[e,i]=t.split(":");return e.length>2&&(e=e.split(" ")[1]),"".concat(e,":").concat(i)}};d.\u0275fac=function(e){return new(e||d)(f(fe),f(me),f(re),f(ne),f(de),f(he))},d.\u0275cmp=H({type:d,selectors:[["app-check-out"]],standalone:!0,features:[V],decls:11,vars:8,consts:[[1,"ion-padding"],[1,"date-time-card","ion-text-center"],["color","dark"],[1,"ion-no-margin","font-bold"],["color","primary"],[1,"ion-no-margin"],[1,"ion-text-center"],["lines","none"],["slot","start"],[3,"src"],["lines","solid",1,"ion-margin-top"],["aria-hidden","true","name","alarm","slot","start","color","success"],[1,"font-bold"],[1,"font-bold","ion-text-end"],["aria-hidden","true","name","alarm","slot","start","color","warning"],["color","success",3,"value"],[1,"ion-text-center","ion-padding-top"],["color","danger"],["expand","block","color","danger",1,"ion-padding-horizontal","ion-margin-bottom","ion-margin-top",3,"click","disabled"]],template:function(e,i){e&1&&(s(0,"ion-content",0)(1,"ion-card",1)(2,"ion-card-content")(3,"ion-text",2)(4,"h2",3),p(5),c()(),s(6,"ion-text",4)(7,"span",5),p(8),c()()()(),E(9,ve,27,9,"ion-card"),c(),E(10,Se,5,2,"ion-footer",6)),e&2&&(a(),T("margin-top",0,"px"),a(4),_(i.currentDay),a(),T("font-size",1.8,"rem"),a(2),x("",i.currentTime," \u0E19."),a(),v(i.userProfile?9:-1),a(),v(i.userProfile?10:-1))},dependencies:[oe,G,Z,J,X,Y,K,q,ee,te,ae,ie,Q],styles:['@charset "UTF-8";.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}ion-footer[_ngcontent-%COMP%]{position:absolute;background:#fff;bottom:0}ion-progress-bar[_ngcontent-%COMP%]{height:16px;border-radius:0}']});let u=d;return u})();var je=[{path:"",component:xe}];export{je as default};
